
[default]

; Comment-out the following clause if you want Allstar Autopatch service
[radio]
exten => _NXXNXXXXXX,1,playback(ss-noservice)
	same => n,Congestion


[timer]
exten => patch,1,Answer(,i)
	same => n,Wait(0.1) ; Rpt() currently rejects calls until 2 seconds after module load
	same => n,UserEvent(nodestart) ; this will trigger a call to 123@repeaters
	same => n,Wait(5.0)
	same => n,UserEvent(activated) ; trigger disconnect right after connect
	same => n,Set(TONE_DETECT(350,5000,c(timer,s,got-dt))=) ; enable tone detection
	same => n,UserEvent(dialtone, Result: Fail)
	same => n,Hangup()
	same => n(got-dt),UserEvent(dialtone, Result: Pass) ; trigger dialtone found
	same => n, Wait(20.0)
	same => n,Set(TONE_DETECT(620,5000,b(timer,s,got-busy))=) ; enable tone detection
	same => n,UserEvent(Congestion, Result: Fail)
	same => n,Hangup()
	same => n(got-busy),UserEvent(congestion, Result: Pass) ; trigger congestion found
	same => n,Hangup()
